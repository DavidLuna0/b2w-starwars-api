image: docker:stable

variables:
  DOCKER_DRIVER: overlay
services:
  - docker:dind
before_script:
  - docker info


stages:
   - test
   - build
   - docker build

before_script:
  - chmod +x mvnw

test:
  image: java:8
  stage: test
  script: ./mvnw test

build:
  image: java:8
  stage: build
  script: ./mvnw package -Dmaven.test.skip=true
  artifacts:
    paths:
      - target/b2w-starwars-api-1.0.1.jar

docker_build:
  stage: docker build
  script: 
      - docker build --tag starwars-api:1.0.1 .
      - docker login -u $DOCKER_USER -p $DOCKER_PASSWORD docker.io
      - docker push starwars-api:1.0.1